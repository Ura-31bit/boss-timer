<script>

if ('serviceWorker' in navigator) {

  navigator.serviceWorker.register('sw.js');

}

const BOSSES = [

  { name: "サシ活", respawn: 180, notifyBefore: 30 },

  { name: "通常ボス", respawn: 180, notifyBefore: 30 },

  { name: "残燃モエコ", respawn: 1800, notifyBefore: 300 },

  { name: "朽ちざる竜骸 イゾ", respawn: 1800, notifyBefore: 300 },

  { name: "黎明神 トモダチ", respawn: 1800, notifyBefore: 300 },

  { name: "古代魚 ザコーン", respawn: 1800, notifyBefore: 300 },

  { name: "禁域のアヌビシュ", respawn: 1800, notifyBefore: 300 },

  { name: "禁域のクマヌイ", respawn: 1800, notifyBefore: 300 },

  { name: "禁域のヴァルネシア", respawn: 1800, notifyBefore: 300 },

  { name: "時空竜クロノゼリウス", respawn: 86400, notifyBefore: 300 }

];

const container = document.getElementById("buttons");

// 複数管理

let activeBosses = JSON.parse(localStorage.getItem("activeBosses")) || [];

BOSSES.forEach(boss => {

  const btn = document.createElement("button");

  btn.textContent = boss.name;

  btn.dataset.name = boss.name;

  if (activeBosses.includes(boss.name)) {

    btn.classList.add("active");

  }

  btn.onclick = () => toggleBoss(boss, btn);

  container.appendChild(btn);

});

function toggleBoss(boss, btn) {

  const index = activeBosses.indexOf(boss.name);

  if (index === -1) {

    // ▶ 計測開始

    activeBosses.push(boss.name);

    btn.classList.add("active");

    setBossTimer(boss);

  } else {

    // ⏹ 計測解除（見た目のみ）

    activeBosses.splice(index, 1);

    btn.classList.remove("active");

  }

  localStorage.setItem("activeBosses", JSON.stringify(activeBosses));

}

function setBossTimer(boss) {

  if (Notification.permission !== "granted") {

    Notification.requestPermission();

  }

  const notifyTime =

    Date.now() + (boss.respawn - boss.notifyBefore) * 1000;

  navigator.serviceWorker.ready.then(reg => {

    reg.showNotification(

      `${boss.name}のリポップ${boss.notifyBefore}秒前です。`,

      {

        showTrigger: new TimestampTrigger(notifyTime),

        body: "準備してください"

      }

    );

  });

}
</script>
 
