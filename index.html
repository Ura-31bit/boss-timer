<script>
if ("serviceWorker" in navigator) {
 navigator.serviceWorker.register("sw.js");
}
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒœã‚¹å¾©æ´»é€šçŸ¥</title>
<style>

body {

  font-family: -apple-system, BlinkMacSystemFont, sans-serif;

  background: #111;

  color: #fff;

  text-align: center;

  margin: 0;

  padding: 20px;

}

button {

  width: 100%;

  font-size: 18px;

  padding: 15px;

  margin: 8px 0;

  border-radius: 12px;

  border: none;

  background: #2563eb;

  color: white;

}

.active {

  background: #16a34a !important;

}

.time {

  font-size: 14px;

  margin-top: 4px;

  opacity: 0.9;

}
</style>
</head>
<body>
<h1>ğŸ—¡ ãƒœã‚¹å¾©æ´»é€šçŸ¥</h1>
<div id="buttons"></div>
<script>

const BOSSES = [

  { name: "ã‚µã‚·æ´»", respawn: 180, notifyBefore: 30 },

  { name: "é€šå¸¸ãƒœã‚¹", respawn: 180, notifyBefore: 30 },

  { name: "æ®‹ç‡ƒãƒ¢ã‚¨ã‚³", respawn: 1800, notifyBefore: 300 },

  { name: "æœ½ã¡ã–ã‚‹ç«œéª¸ ã‚¤ã‚¾", respawn: 1800, notifyBefore: 300 },

  { name: "é»æ˜ç¥ ãƒˆãƒ¢ãƒ€ãƒ", respawn: 1800, notifyBefore: 300 },

  { name: "å¤ä»£é­š ã‚¶ã‚³ãƒ¼ãƒ³", respawn: 1800, notifyBefore: 300 },

  { name: "ç¦åŸŸã®ã‚¢ãƒŒãƒ“ã‚·ãƒ¥", respawn: 1800, notifyBefore: 300 },

  { name: "ç¦åŸŸã®ã‚¯ãƒãƒŒã‚¤", respawn: 1800, notifyBefore: 300 },

  { name: "ç¦åŸŸã®ãƒ´ã‚¡ãƒ«ãƒã‚·ã‚¢", respawn: 1800, notifyBefore: 300 },

  { name: "æ™‚ç©ºç«œã‚¯ãƒ­ãƒã‚¼ãƒªã‚¦ã‚¹", respawn: 86400, notifyBefore: 300 }

];

const container = document.getElementById("buttons");

// { ãƒœã‚¹å: é–‹å§‹æ™‚åˆ» }

let activeBosses = JSON.parse(localStorage.getItem("activeBosses")) || {};

const buttons = {};

BOSSES.forEach(boss => {

  const btn = document.createElement("button");

  btn.dataset.name = boss.name;

  const label = document.createElement("div");

  label.textContent = boss.name;

  const time = document.createElement("div");

  time.className = "time";

  btn.appendChild(label);

  btn.appendChild(time);

  if (activeBosses[boss.name]) {

    btn.classList.add("active");

  }

  btn.onclick = () => startBoss(boss, btn, time);

  container.appendChild(btn);

  buttons[boss.name] = { btn, time, boss };

});

function startBoss(boss, btn, timeEl) {

  if (!activeBosses[boss.name]) {

    activeBosses[boss.name] = Date.now();

    localStorage.setItem("activeBosses", JSON.stringify(activeBosses));

    btn.classList.add("active");

    setBossNotification(boss);

  }

}

function setBossNotification(boss) {

  if (Notification.permission !== "granted") {

    Notification.requestPermission();

  }

  const notifyTime =

    Date.now() + (boss.respawn - boss.notifyBefore) * 1000;

  navigator.serviceWorker?.ready.then(reg => {

    reg.showNotification(

      `${boss.name}ã®ãƒªãƒãƒƒãƒ—${boss.notifyBefore}ç§’å‰ã§ã™ã€‚`,

      { showTrigger: new TimestampTrigger(notifyTime) }

    );

  });

}

function formatTime(sec) {

  const h = Math.floor(sec / 3600);

  const m = Math.floor((sec % 3600) / 60);

  const s = sec % 60;

  return `${h}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;

}

function updateTimes() {

  const now = Date.now();

  Object.keys(activeBosses).forEach(name => {

    const start = activeBosses[name];

    const boss = BOSSES.find(b => b.name === name);

    const elapsed = Math.floor((now - start) / 1000);

    const remain = boss.respawn - elapsed;

    const { btn, time } = buttons[name];

    if (remain > 0) {

      time.textContent = `æ®‹ã‚Š ${formatTime(remain)}`;

    } else {

      time.textContent = "å¾©æ´»æ¸ˆã¿";

    }

  });

}

setInterval(updateTimes, 1000);

updateTimes();
</script>
</body>
</html>
 

